---
name: AI Coder Task (General)
about: Define a specific, incremental coding task suitable for an AI Coder agent.
title: 'feat: message normalization and role mapping'
labels: 'status: ready, type: epic-task, priority: high, effort: small, component: api, component: testing, tech: dotnet, epic: language-model-service-v2'
assignees: ''

---

## 1. Overall Goal / User Story Context

Provide a single normalization layer translating unified messages to provider-specific formats (OpenAI-compatible and Venice REST), including tool/function role mapping.

## 2. Requirements (Mandatory Expectations)

- Align with role mappings in architecture-design.md (`tool` â‡„ `function` for OpenAI)
- Normalize tool calls and map assistant/tool messages consistently
- Include robust unit tests for edge cases (system hoisting handled separately if ever needed)

## 3. Specific Task Objective

Implement `IMessageNormalizer` + concrete `MessageNormalizer`:
- Convert unified messages to OpenAI-compatible payloads
- Prepare for Venice (OpenAI-compatible REST)
- Round-trip friendly conversion assumptions documented

## 4. Acceptance Criteria

- [ ] `IMessageNormalizer` and `MessageNormalizer` implemented in `/Services/AI/*`
- [ ] Unit tests cover roles, tool calls, tool response mapping
- [ ] No provider SDK references in the normalizer
- [ ] Documentation comments explain mappings and limitations

## 5. Affected Components

- `Code/Zarichney.Server/Services/AI/Normalization/*`
- `Code/Zarichney.Server.Tests/Services/AI/Normalization/*`
- `Docs/Specs/epic-246-language-model-service/01-architecture-design.md`

## 6. Relevant Background / Links

- Docs/Specs/epic-246-language-model-service/01-architecture-design.md
- Docs/Standards/TaskManagementStandards.md

## 7. (Optional) Implementation Notes / Plan

- Keep serialization-light; return simple anonymous/dynamic DTOs for REST client to serialize

---
*Generated by Planning Assistant*

