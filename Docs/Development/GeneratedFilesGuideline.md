# Generated Files & Copilot User Guidelines

**Last Updated:** 2025-09-06  
**Purpose:** Prevent contamination of PRs with auto-generated files and large artifacts

## 🚫 Files That Should NEVER Be Committed

### Critical Generated Files
These files are auto-generated and committing them causes AI Sentinel failures due to token limits:

#### Swagger/OpenAPI Files
- `**/swagger.json` (especially `Code/Zarichney.Server/swagger.json`)
- `**/swagger.yaml`
- `**/openapi.json` 
- `**/openapi.yaml`

**Why:** These files can be 5,000+ lines and are generated dynamically by the server. They should be produced by build/generation scripts, not committed to source control.

#### Auto-Generated API Client Files (Special Case)
- `Code/Zarichney.Server.Tests/Framework/Client/*.cs` files

**Current Status:** These are tracked in git because they're generated via controlled scripts and needed for integration tests. However, **manual modifications are forbidden** as they will be overwritten.

## 🛡️ Prevention Measures

### .gitignore Protection
The `.gitignore` file has been updated with patterns to prevent swagger files:

```gitignore
# Generated API Documentation & Client Files
**/swagger.json
**/swagger.yaml
**/openapi.json
**/openapi.yaml
```

### Pre-Commit Checks
Before committing, always verify:

```bash
# Use the automated validation script
./Scripts/validate-pre-commit.sh

# Manual checks if needed
git status
git diff --cached

# Look for large files or generated content
git diff --cached --stat
```

The `validate-pre-commit.sh` script automatically:
- Detects large files in staging area
- Warns about potential swagger/openapi files
- Identifies modifications to auto-generated code
- Shows summary of all changes being committed

## 📋 Copilot User Guidelines

### Before Making Any Commits

1. **Review file changes carefully**
   - Check `git status` for unexpected files
   - Use `git diff --stat` to identify large file additions
   - Avoid files with thousands of lines unless intentional

2. **Understand auto-generated content**
   - Files marked with `// <auto-generated>` should not be manually edited
   - Swagger files are runtime-generated and should not be committed
   - API client files have specific regeneration procedures

3. **When in doubt, ask**
   - If you see large JSON/YAML files, question whether they should be committed
   - Check if the file is listed in generation scripts (`Scripts/generate-*.sh`)

### Common Pitfalls

#### ❌ Don't Do This
```bash
# This adds everything including generated files
git add .
git commit -m "fix: some change"
```

#### ✅ Do This Instead
```bash
# Add specific files you intend to change
git add path/to/specific/file.cs
git add .github/workflows/some-workflow.yml

# Review what's staged
git status
git diff --cached

# Then commit
git commit -m "fix: specific change description"
```

## 🔧 File Regeneration Procedures

### API Client Regeneration
When API contracts change, use the provided scripts:

```bash
# Regenerate API clients after server changes
./Scripts/generate-api-client.sh
```

**Note:** This script automatically:
1. Builds the server
2. Generates swagger.json temporarily
3. Uses refitter to create client interfaces
4. Cleans up the swagger.json file

### Never Manually Edit
- `Code/Zarichney.Server.Tests/Framework/Client/IAuthApi.cs`
- `Code/Zarichney.Server.Tests/Framework/Client/IAiApi.cs` 
- `Code/Zarichney.Server.Tests/Framework/Client/Contracts.cs`
- Any file with `// <auto-generated>` header

## 🚨 Emergency Recovery

If you accidentally commit generated files:

### For Current PR
```bash
# Remove the problematic file
git rm Code/Zarichney.Server/swagger.json

# Commit the removal
git commit -m "fix: remove accidentally committed swagger.json"

# Push the fix
git push origin your-branch-name
```

### For Already-Merged Issues
Create a new PR to:
1. Remove the problematic files
2. Update .gitignore if needed
3. Document the issue for future prevention

## 📊 Impact of Generated File Contamination

### AI Sentinel Failures
Large generated files cause:
- Token limit exceeded errors
- Failed analysis from DebtSentinel, StandardsGuardian, TestMaster, SecuritySentinel, MergeOrchestrator
- Blocked PR merging due to failed quality gates

### Repository Health
- Inflated repository size
- Difficult code reviews (noise vs. signal)
- Confusion about what code is actually changing

## 🎯 Success Criteria

A clean PR should:
- Contain only intentional source code changes
- Have minimal line count changes relative to the actual feature/fix
- Pass all AI Sentinel analyses
- Be easily reviewable by humans and AI

## 📚 Related Documentation

- [API Client Generation README](../../Code/Zarichney.Server.Tests/Framework/Client/README.md)
- [Task Management Standards](../Standards/TaskManagementStandards.md)
- [Testing Standards](../Standards/TestingStandards.md)

---

**Remember:** When in doubt about whether a file should be committed, it's better to ask than to contaminate a PR with generated content that causes AI analysis failures.